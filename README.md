# Demonstration of PostLoad events not being triggered when retrieving objects by reference

## Usage

This application requires an executable file `bin/php` that loads the correct PHP binary (as generated by our internal
tool `phlough` on `phlough install`).

First, install dependencies and create a new database with the correct schema (will create an SQLite database in ./tmp)

```bash
composer install

bin/doctrine orm:schema-tool:create
```

Create an Entity and load it normally

```bash
bin/create-new-entity # assume it creates an entity with id 1
bin/load-entity 1 # Output should contain: PostLoad EventListener called for Entity\Test#1
```

Load the same entity by reference and access a property to trigger initialisation

```bash
bin/load-entity-by-reference-and-access-proprty 1 # Will the output contain: "PostLoad EventListener called"?
```

## Explanation

When loading an entity by reference, whether the object will be initialised on a method call or property access depends
on the implementation of uninitialised object. Using either doctrine/orm 2.x or 3.x, there are 3 possible
implementations:

### Proxy using Doctrines Proxy Generator (doctrine 2.x default, gone in doctrine 3.x)

Proxies will be initialised on method calls.

### "Lazy Ghost Object" using Symfony's VarExporter\LazyGhostTrait (doctrine 3.x default)

Proxies will be initialised only when accessing mapped properties. This could become a problem if you want to initialise
an unmapped property via the PostLoad event.

### PHP 8.4 Native lazy objects (requires PHP 8.4+ and doctrine/orm 3.x and `$config->enableNativeLazyObjects(true);`)

Could not test as we have no PHP 8.4 environment yet.

See https://github.com/doctrine/DoctrineBundle/issues/1651#issuecomment-1684297751
